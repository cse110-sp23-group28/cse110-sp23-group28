# Team: CSE 110 SP23 Team 28, UC Sussy Developers
# Date: 5/19/2023
# Authors: Brandon Reponte
# Description: CI/CD linter file for stylisitc conventions on baeometer

# naming
name: linter
run-name: Code is linting for stylistic conventions (CI/CD)

# trigger for workflow
on:
  push:
    branches:
      - main

# jobs to run in workflow
jobs:
  # job named eslint
  eslint:
    # specifices which version this job will be run in
    runs-on: ubuntu-latest

    # list of steps under eslint job
    name: ESLint
    steps:
      # Checkout repository
      - name: Checkout repository
      uses: actions/checkout@v3   # Note: Understand v2 vs v3

      # Restrict to only .webp images (got from ChatGPT, unsure...)
      - name: Check image format
      run: |
        for file in $(find . -type f -name "*.webp"); do
          if ! identify -format "%m" "$file" | grep -q "WEBP"; then
            echo "Error: Invalid image format for file $file"
            exit 1
          fi
        done
      
      # Run ESLint
      - name: Run ESLint
      # initialize package.json
      run: npm init

      # locally install ESLint
      run: npm install --save-dev eslint

      # initialize ESLint configurations
      run: eslint --init

      # install JSDoc plugin
      run: npm install --save-dev eslint-plugin-jsdoc

      # install file names plugin
      run: npm install eslint-plugin-filenames --save-dev

      # install file header plugin
      run: npm install eslint-plugin-header --save-dev

      # run ESLint on JS files in baeometer directory
      run: npx eslint source/baeometer/*.js

      