{"version":3,"file":"noMissingSyntax.js","names":["_esquery","_interopRequireDefault","require","_iterateJsdoc","obj","__esModule","default","setDefaults","state","selectorMap","incrementSelector","selector","comment","_default","iterateJsdoc","context","node","info","sourceCode","options","contexts","foundContext","find","cntxt","esquery","matches","parse","visitorKeys","contextStr","String","contextSelected","exit","settings","length","report","loc","end","column","line","start","message","some","contextKey","minimum","Object","values","every","cmmnt","data","matchContext","meta","docs","description","url","fixable","schema","additionalProperties","properties","items","anyOf","type","exports","module"],"sources":["../../src/rules/noMissingSyntax.js"],"sourcesContent":["import esquery from 'esquery';\nimport iterateJsdoc from '../iterateJsdoc';\n\n/**\n * @typedef {{\n *   comment: string,\n *   context: string,\n *   message: string,\n *   minimum: import('../iterateJsdoc.js').Integer\n * }} ContextObject\n */\n\n/**\n * @typedef {string|ContextObject} Context\n */\n\n/**\n * @param {import('../iterateJsdoc.js').StateObject} state\n * @returns {void}\n */\nconst setDefaults = (state) => {\n  if (!state.selectorMap) {\n    state.selectorMap = {};\n  }\n};\n\n/**\n * @param {import('../iterateJsdoc.js').StateObject} state\n * @param {string} selector\n * @param {string} comment\n * @returns {void}\n */\nconst incrementSelector = (state, selector, comment) => {\n  if (!state.selectorMap[selector]) {\n    state.selectorMap[selector] = {};\n  }\n\n  if (!state.selectorMap[selector][comment]) {\n    state.selectorMap[selector][comment] = 0;\n  }\n\n  state.selectorMap[selector][comment]++;\n};\n\nexport default iterateJsdoc(({\n  context,\n  node,\n  info: {\n    comment,\n  },\n  sourceCode,\n  state,\n}) => {\n  if (!context.options[0]) {\n    // Handle error later\n    return;\n  }\n\n  /**\n   * @type {Context[]}\n   */\n  const contexts = context.options[0].contexts;\n\n  const foundContext = contexts.find((cntxt) => {\n    return typeof cntxt === 'string' ?\n      esquery.matches(\n        node,\n        esquery.parse(cntxt),\n        null,\n        // https://github.com/DefinitelyTyped/DefinitelyTyped/pull/65460\n        // @ts-expect-error\n        {\n          visitorKeys: sourceCode.visitorKeys,\n        },\n      ) :\n      (!cntxt.context || cntxt.context === 'any' ||\n      // https://github.com/DefinitelyTyped/DefinitelyTyped/pull/65460\n      // @ts-expect-error\n      esquery.matches(node, esquery.parse(cntxt.context), null, {\n        visitorKeys: sourceCode.visitorKeys,\n      })) &&\n        comment === cntxt.comment;\n  });\n\n  const contextStr = typeof foundContext === 'object' ?\n    foundContext.context ?? 'any' :\n    String(foundContext);\n\n  setDefaults(state);\n\n  incrementSelector(state, contextStr, String(comment));\n}, {\n  contextSelected: true,\n  exit ({\n    context,\n    settings,\n    state,\n  }) {\n    if (!context.options.length && !settings.contexts) {\n      context.report({\n        loc: {\n          end: {\n            column: 1,\n            line: 1,\n          },\n          start: {\n            column: 1,\n            line: 1,\n          },\n        },\n        message: 'Rule `no-missing-syntax` is missing a `contexts` option.',\n      });\n\n      return;\n    }\n\n    setDefaults(state);\n\n    /**\n     * @type {Context[]}\n     */\n    const contexts = (context.options[0] ?? {}).contexts ?? settings?.contexts;\n\n    // Report when MISSING\n    contexts.some((cntxt) => {\n      const contextStr = typeof cntxt === 'object' ? cntxt.context ?? 'any' : cntxt;\n      const comment = typeof cntxt === 'string' ? '' : cntxt?.comment;\n\n      const contextKey = contextStr === 'any' ? 'undefined' : contextStr;\n\n      if (\n        (!state.selectorMap[contextKey] ||\n        !state.selectorMap[contextKey][comment] ||\n        state.selectorMap[contextKey][comment] < (\n          // @ts-expect-error comment would need an object, not string\n          cntxt?.minimum ?? 1\n        )) &&\n        (contextStr !== 'any' || Object.values(state.selectorMap).every((cmmnt) => {\n          return !cmmnt[comment] || cmmnt[comment] < (\n            // @ts-expect-error comment would need an object, not string\n            cntxt?.minimum ?? 1\n          );\n        }))\n      ) {\n        const message = typeof cntxt === 'string' ?\n          'Syntax is required: {{context}}' :\n          cntxt?.message ?? ('Syntax is required: {{context}}' +\n            (comment ? ' with {{comment}}' : ''));\n        context.report({\n          data: {\n            comment,\n            context: contextStr,\n          },\n          loc: {\n            end: {\n              column: 1,\n              line: 1,\n            },\n            start: {\n              column: 1,\n              line: 1,\n            },\n          },\n          message,\n        });\n\n        return true;\n      }\n\n      return false;\n    });\n  },\n  matchContext: true,\n  meta: {\n    docs: {\n      description: 'Reports when certain comment structures are always expected.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-no-missing-syntax',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                    message: {\n                      type: 'string',\n                    },\n                    minimum: {\n                      type: 'integer',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}